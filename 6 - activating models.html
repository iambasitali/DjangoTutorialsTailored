<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Django Tailored</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./gcp/prettify.css">
    <link rel="stylesheet" type="text/css" href="./gcp/skins/sons-of-obsidian.css">
    <link rel="stylesheet" type="text/css" href="font-styles.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script type="text/javascript" src="./gcp/prettify.js"></script>
    <script>
    $(document).ready(function() {
        $('[data-toggle="popover"]').popover({ html: true });
    });
    </script>
</head>
<body onload="PR.prettyPrint()" cz-shortcut-listen="true">
    <div class="container">
        <main class="col-12 p-3 bd-content" role="main">
            <h4 class="text-muted"><u>Activating Models</u></h4>
            <p>The two models that we created in last lecture will create two tables in the Database having the columns which I mentioned in the previous lecture.</p>
            <p>But first we need to install the app <code>todo_app</code> and then we have to include the app in our project. Edit the todo/settings.py file and add that dotted path <code>'todo_app.apps.TodoAppConfig'</code> to the INSTALLED_APPS setting. It will look like this:</p>
            <div class="highlight">
                <pre class="prettyprint pre-highlight">todo/settings.py</pre>
                <pre class="prettyprint">INSTALLED_APPS [<br/>'todo_app.apps.TodoAppConfig'<br />'django.contrib.admin'<br />'django.contrib.auth'<br />'django.contrib.contenttypes'<br/>'django.contrib.sessions'<br/>'django.contrib.messages'<br/>'django.contrib.staticfiles'<br/>]
                </pre>
            </div>
            <p>Let’s run another command to create migrations.</p>
            <div class="highlight">
                <pre class="prettyprint">(venv) $ python manage.py makemigrations todo_app</pre>
            </div>
            <p>You should see something similar to the following:</p>
            <div class="highlight">
                <pre class="prettyprint">migrations for 'todo_app' <br/>todo_app/migrations/0001_initial.py <br/>- Create model Category <br/>- Create model Item <br/>
                    </pre>
            </div>
            <p>By running this command Django will create migration as shown in the above command.</p>
            <p>Migrations are Django way of track the changes you have made in your models (Add/Edit a field, Deleting a model) into your database schema. The file will create in the specific location todo_app/migrations/0001_initial.py. These files are editable so we can also edit these files manuly but this is not good approac, so we have to follow with command line.</p>
            <p>There is a command that will run the migrations and manage your database schema automatically.</p>

            <div class="highlight">
                <pre class="prettyprint">(venv) $ python manage.py sqlmigrate todo_app 0001</pre>
            </div>
            <p>This command will return a SQL query which function it has performed with DB. In our case its creating two tables so it will return the SQL code to create a tables.</p>

            <div class="highlight">
                <pre class="prettyprint">BEGIN<br/>--<br/>--<br/>--<br/>CREATE TABLE "todo_app_category"<br>"id" integer NOT NULL PRIMARY KEY AUTOINCREMENT,<br/>"name" varchar(200) NOT NULL,<br/>"pub_date" datetime NOT NULL<br/>);<br/>CREATE INDEX "todo_app_item_category_id_1e571fc3" ON "todo_app_item" ("category_id");<br/>COMMIT;</pre>
            </div>
                 <p>Note the following:</p>
                    <ul class="body-ul">
                        <li>The exact output will vary and depends on the models. The example above is generated for SQLite.</li>
                        <li>Table names are automatically generated by combining the name of the app and the name of the model (We can overwrite this behaviour).</li>
                        <li>Primary key is added automatically. (We can overwrite this behaviour)</li>
                        <li>By convention, Django appends <code>_id</code> to the foreign key field name. (We can overwrite this functionality as well)</li>
                        <li>The foreign key relationship is made by a FOREIGN KEY constraint as we used in the above <code>Item</code> Model.</li>
                        <li>Database specific field types like integer primary key auto-increment (SQLite) are handled automatically.</li>
                        <li>The migrate command does not actually run the migrations on your database - instead, it prints SQL to the cmd screen so that you can see SQL and will make if needs any changes.</li>
                    </ul>
                    <p>If you are interested to check whether the project is error free or not, then type the below command in cmd. This check will be without making migrations or touching the database.</p>
                    <p>Now, run migrate again to create those model tables in your database:</p>

                <div class="highlight">
                    <pre class="prettyprint">(venv) $ python manage.py migrate<br/>Operations to perform:<br/>Apply all migrations: admin, auth, contenttypes, todo_app, sessions<br/>Running migrations:<br/>Rendering model states... DONE<br>Applying todo_app.0001_initial... OK</pre>
                </div>
                   <p>The migrate command takes all the migrations that haven’t been applied and will touch the DB schema.</p>
                    <p>Migrations are very powerful and let you change your models as per your requirements, for example we lost our DB but in Models we have DB schema we can recreate DB with in few seconds.</p>
                    <p>For now just remember these three steps of Migrations:</p>
                    <ul class="body-ul">
                        <li>Add/Edit your models (in models.py).</li>
                        <li>Run python manage.py makemigrations to create migrations for those changes</li>
                        <li>Run python manage.py migrate to apply those changes to the database.</li>
                    </ul>
</main>
</div>

</body>
</html>